<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Aurum — Crypto Intelligence</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,500;0,700;1,400&family=Outfit:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --ink:        #0f0e0c;
  --ink2:       #161410;
  --ink3:       #1e1b17;
  --ink4:       #252118;
  --ink5:       #2e2920;

  --gold:       #c8a96e;
  --gold-light: #e2c98a;
  --gold-pale:  #f5e6c8;
  --gold-dim:   rgba(200,169,110,0.12);
  --gold-glow:  rgba(200,169,110,0.25);

  --up:         #4eca8b;
  --up-dim:     rgba(78,202,139,0.1);
  --down:       #e05c6b;
  --down-dim:   rgba(224,92,107,0.1);
  --neutral:    #7b9cc4;
  --neutral-dim:rgba(123,156,196,0.1);

  --text:       #f0ead8;
  --text2:      #a89880;
  --text3:      #6b5e4e;
  --text4:      #3d3328;

  --border:     rgba(200,169,110,0.1);
  --border2:    rgba(200,169,110,0.06);
  --shadow:     rgba(0,0,0,0.4);
}

*, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }

body {
  background: var(--ink);
  color: var(--text);
  font-family: 'Outfit', sans-serif;
  font-weight: 400;
  min-height: 100vh;
  overflow-x: hidden;
  -webkit-font-smoothing: antialiased;
}

/* ─── BACKGROUND MESH ─────────────────────────────────────────────────── */
.bg-layer {
  position: fixed; inset: 0; pointer-events: none; z-index: 0;
  overflow: hidden;
}
.bg-layer::before {
  content: '';
  position: absolute;
  width: 900px; height: 900px;
  top: -300px; right: -200px;
  background: radial-gradient(ellipse, rgba(200,169,110,0.04) 0%, transparent 65%);
  animation: floatA 18s ease-in-out infinite alternate;
}
.bg-layer::after {
  content: '';
  position: absolute;
  width: 600px; height: 600px;
  bottom: -100px; left: -100px;
  background: radial-gradient(ellipse, rgba(78,202,139,0.03) 0%, transparent 65%);
  animation: floatB 24s ease-in-out infinite alternate;
}
@keyframes floatA { 0%{transform:translate(0,0) scale(1)} 100%{transform:translate(-60px,80px) scale(1.1)} }
@keyframes floatB { 0%{transform:translate(0,0)} 100%{transform:translate(80px,-60px)} }

/* Subtle grain texture */
.grain {
  position: fixed; inset: 0; pointer-events: none; z-index: 1;
  opacity: 0.025;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
  background-repeat: repeat;
  background-size: 200px 200px;
}

/* ─── LAYOUT ──────────────────────────────────────────────────────────── */
.wrap {
  position: relative; z-index: 2;
  max-width: 1380px; margin: 0 auto;
  padding: 0 28px 60px;
}

/* ─── HEADER ──────────────────────────────────────────────────────────── */
nav {
  display: flex; align-items: center; justify-content: space-between;
  padding: 28px 0 24px;
  border-bottom: 1px solid var(--border2);
  gap: 20px; flex-wrap: wrap;
}

.brand {
  display: flex; align-items: baseline; gap: 12px;
}

.brand-name {
  font-family: 'Playfair Display', serif;
  font-size: 1.75em; font-weight: 700;
  color: var(--gold-light);
  letter-spacing: 0.04em;
}

.brand-dot {
  width: 5px; height: 5px; border-radius: 50%;
  background: var(--gold); margin-bottom: 3px;
  box-shadow: 0 0 10px var(--gold-glow);
  animation: glow 3s ease-in-out infinite;
}
@keyframes glow { 0%,100%{opacity:1;box-shadow:0 0 10px var(--gold-glow)} 50%{opacity:.5;box-shadow:0 0 4px var(--gold-glow)} }

.brand-tagline {
  font-size: 0.62em; font-weight: 300;
  color: var(--text3); letter-spacing: 0.18em;
  text-transform: uppercase;
}

.nav-right {
  display: flex; align-items: center; gap: 16px;
}

.live-chip {
  display: flex; align-items: center; gap: 7px;
  background: var(--ink3);
  border: 1px solid var(--border);
  border-radius: 30px; padding: 6px 14px;
  font-size: 0.7em; font-weight: 500;
  color: var(--text2); letter-spacing: 0.06em;
}
.live-dot {
  width: 6px; height: 6px; border-radius: 50%;
  background: var(--up);
  box-shadow: 0 0 8px rgba(78,202,139,0.5);
  animation: pulse 2.5s ease-in-out infinite;
}
@keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.3} }

.clock {
  font-size: 0.72em; font-weight: 300;
  color: var(--text3); letter-spacing: 0.06em;
  font-variant-numeric: tabular-nums;
}

.btn-refresh {
  background: transparent;
  border: 1px solid var(--border);
  border-radius: 8px; padding: 7px 18px;
  color: var(--text2); font-family: 'Outfit', sans-serif;
  font-size: 0.72em; font-weight: 500;
  cursor: pointer; letter-spacing: 0.06em;
  transition: all .25s;
}
.btn-refresh:hover {
  background: var(--gold-dim);
  border-color: var(--gold);
  color: var(--gold-light);
}
.btn-refresh:disabled { opacity:.35; cursor:not-allowed; }

/* ─── API KEY ──────────────────────────────────────────────────────────── */
.api-row {
  display: flex; align-items: center; gap: 14px;
  background: var(--ink3);
  border: 1px solid var(--border2);
  border-radius: 14px; padding: 13px 20px;
  margin: 20px 0 0;
  flex-wrap: wrap; gap: 10px;
}
.api-label {
  font-size: 0.65em; font-weight: 600;
  color: var(--gold); letter-spacing: 0.12em;
  text-transform: uppercase; white-space: nowrap;
}
.api-field {
  flex: 1; min-width: 220px;
  background: var(--ink2);
  border: 1px solid var(--border2);
  border-radius: 9px; padding: 9px 14px;
  color: var(--text); font-family: 'Outfit', sans-serif;
  font-size: 0.78em; outline: none;
  transition: border-color .2s, box-shadow .2s;
}
.api-field:focus {
  border-color: var(--gold);
  box-shadow: 0 0 0 2px rgba(200,169,110,0.12);
}
.api-field::placeholder { color: var(--text4); }
.api-note { font-size: 0.63em; color: var(--text3); }

/* ─── COIN PILLS ──────────────────────────────────────────────────────── */
.coin-row {
  display: flex; gap: 10px; margin: 28px 0 20px; flex-wrap: wrap;
}

.coin-pill {
  display: flex; align-items: center; gap: 14px;
  background: var(--ink3);
  border: 1px solid var(--border2);
  border-radius: 16px; padding: 14px 20px;
  cursor: pointer; min-width: 160px;
  transition: all .3s cubic-bezier(.4,0,.2,1);
  position: relative; overflow: hidden;
}
.coin-pill::after {
  content: '';
  position: absolute; bottom: 0; left: 0; right: 0;
  height: 2px; background: var(--gold);
  transform: scaleX(0); transform-origin: left;
  transition: transform .3s cubic-bezier(.4,0,.2,1);
}
.coin-pill:hover { border-color: var(--border); transform: translateY(-2px); box-shadow: 0 8px 24px rgba(0,0,0,.3); }
.coin-pill.active {
  background: var(--ink4);
  border-color: var(--gold);
  box-shadow: 0 4px 20px rgba(200,169,110,0.12);
}
.coin-pill.active::after { transform: scaleX(1); }

.coin-icon {
  width: 36px; height: 36px; border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 1.1em; font-weight: 600;
  background: var(--ink5);
  border: 1px solid var(--border);
  flex-shrink: 0;
  transition: all .3s;
}
.coin-pill.active .coin-icon {
  background: var(--gold-dim);
  border-color: var(--gold);
  color: var(--gold-light);
}

.coin-info { flex: 1; }
.coin-sym {
  font-size: 0.8em; font-weight: 600;
  color: var(--text2); letter-spacing: 0.06em;
}
.coin-pill.active .coin-sym { color: var(--gold-light); }
.coin-price {
  font-size: 0.88em; font-weight: 500;
  color: var(--text); margin-top: 2px;
  font-variant-numeric: tabular-nums;
}
.coin-chg {
  font-size: 0.65em; font-weight: 500; margin-top: 1px;
  font-variant-numeric: tabular-nums;
}
.up-c { color: var(--up); }
.dn-c { color: var(--down); }

/* ─── CONTROLS BAR ──────────────────────────────────────────────────────── */
.ctrl-bar {
  display: flex; align-items: center; gap: 8px;
  margin-bottom: 22px; flex-wrap: wrap;
}
.ctrl-label {
  font-size: 0.63em; font-weight: 500;
  color: var(--text3); letter-spacing: 0.12em;
  text-transform: uppercase; margin-right: 2px;
}
.tf-btn {
  background: transparent;
  border: 1px solid var(--border2);
  border-radius: 8px; padding: 6px 14px;
  color: var(--text3); font-family: 'Outfit', sans-serif;
  font-size: 0.7em; font-weight: 500; cursor: pointer;
  letter-spacing: 0.05em; transition: all .2s;
}
.tf-btn:hover { color: var(--text2); border-color: var(--border); }
.tf-btn.active {
  background: var(--gold-dim);
  border-color: var(--gold);
  color: var(--gold-light); font-weight: 600;
}

.sep { width: 1px; height: 18px; background: var(--border2); margin: 0 6px; }

.weight-ctrl {
  display: flex; align-items: center; gap: 8px;
  font-size: 0.65em; color: var(--text3); font-weight: 400;
}
.weight-ctrl .hi { color: var(--gold); font-weight: 600; min-width: 26px; }

input[type=range] {
  -webkit-appearance: none; appearance: none;
  height: 3px; width: 90px;
  background: linear-gradient(90deg, var(--gold) 60%, var(--ink5) 60%);
  border-radius: 2px; outline: none; cursor: pointer;
}
input[type=range]::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 13px; height: 13px; border-radius: 50%;
  background: var(--gold-light);
  box-shadow: 0 2px 8px rgba(200,169,110,0.4);
  border: 2px solid var(--ink2);
}

.demo-tag {
  background: rgba(255,184,48,.1);
  border: 1px solid rgba(255,184,48,.25);
  border-radius: 6px; padding: 3px 10px;
  font-size: 0.62em; color: #ffb830; letter-spacing: 0.08em;
  display: none; margin-left: auto;
}
.demo-tag.on { display: inline-block; }

/* ─── MAIN GRID ──────────────────────────────────────────────────────── */
.grid {
  display: grid;
  grid-template-columns: 1fr 340px;
  gap: 18px;
}
@media(max-width:1120px){ .grid{ grid-template-columns:1fr; } }

/* ─── CARD BASE ──────────────────────────────────────────────────────── */
.card {
  background: var(--ink3);
  border: 1px solid var(--border2);
  border-radius: 20px;
  overflow: hidden;
  transition: border-color .3s, box-shadow .3s;
}
.card:hover {
  border-color: var(--border);
  box-shadow: 0 8px 40px rgba(0,0,0,.25);
}
.section-title {
  font-size: 0.6em; font-weight: 600;
  color: var(--text3); letter-spacing: 0.18em;
  text-transform: uppercase;
  display: flex; align-items: center; gap: 8px;
}
.section-title::before {
  content: '';
  width: 14px; height: 1px;
  background: var(--gold);
  display: block;
}

/* ─── PRICE HEADER ───────────────────────────────────────────────────── */
.price-head {
  padding: 26px 26px 20px;
  border-bottom: 1px solid var(--border2);
  display: flex; justify-content: space-between; align-items: flex-start;
  flex-wrap: wrap; gap: 12px;
}
.price-left .coin-label {
  font-size: 0.62em; font-weight: 500;
  color: var(--text3); letter-spacing: 0.14em;
  text-transform: uppercase; margin-bottom: 6px;
}
.price-big {
  font-family: 'Playfair Display', serif;
  font-size: 2.2em; font-weight: 700;
  color: var(--text); line-height: 1;
  font-variant-numeric: tabular-nums;
}
.price-change-badge {
  display: inline-flex; align-items: center; gap: 5px;
  margin-top: 8px;
  padding: 4px 12px; border-radius: 20px;
  font-size: 0.72em; font-weight: 600;
  font-variant-numeric: tabular-nums;
}
.price-change-badge.up { background: var(--up-dim); color: var(--up); }
.price-change-badge.dn { background: var(--down-dim); color: var(--down); }

.price-right { text-align: right; }
.timeframe-label {
  font-size: 0.62em; color: var(--text3);
  letter-spacing: 0.1em; text-transform: uppercase;
  margin-bottom: 6px;
}

/* ─── CHART AREA ─────────────────────────────────────────────────────── */
.chart-area { padding: 16px 20px 8px; }

/* ─── IND STRIP ──────────────────────────────────────────────────────── */
.ind-strip {
  display: grid; grid-template-columns: repeat(3,1fr);
  border-top: 1px solid var(--border2);
}
.ind-cell {
  padding: 16px 20px;
  border-right: 1px solid var(--border2);
  transition: background .2s;
}
.ind-cell:last-child { border-right: none; }
.ind-cell:hover { background: rgba(200,169,110,0.03); }
.ind-cell-label {
  font-size: 0.58em; font-weight: 600;
  color: var(--text3); letter-spacing: 0.14em;
  text-transform: uppercase; margin-bottom: 6px;
}
.ind-cell-val {
  font-family: 'Playfair Display', serif;
  font-size: 1.05em; font-weight: 500;
  font-variant-numeric: tabular-nums;
}
.ind-cell-sig { font-size: 0.63em; font-weight: 500; margin-top: 3px; }

/* ─── TREND CARD ─────────────────────────────────────────────────────── */
.trend-panel {
  background: var(--ink3); border: 1px solid var(--border2);
  border-radius: 20px; padding: 26px;
  position: relative; overflow: hidden;
  transition: border-color .3s, box-shadow .3s;
}
.trend-panel:hover {
  border-color: var(--border);
  box-shadow: 0 8px 40px rgba(0,0,0,.25);
}

.trend-glow {
  position: absolute;
  width: 260px; height: 260px; border-radius: 50%;
  top: -100px; right: -80px; pointer-events: none;
  opacity: .07;
  transition: background .6s;
  background: radial-gradient(circle, var(--up), transparent);
}
.trend-panel.bear .trend-glow { background: radial-gradient(circle, var(--down), transparent); }
.trend-panel.neut .trend-glow { background: radial-gradient(circle, var(--neutral), transparent); }

.trend-panel::before {
  content: '';
  position: absolute; top: 0; left: 26px; right: 26px; height: 1px;
  background: linear-gradient(90deg, transparent, var(--up), transparent);
  transition: background .5s;
}
.trend-panel.bear::before { background: linear-gradient(90deg, transparent, var(--down), transparent); }
.trend-panel.neut::before { background: linear-gradient(90deg, transparent, var(--neutral), transparent); }

.t-label {
  font-size: 0.6em; font-weight: 600; color: var(--text3);
  letter-spacing: 0.18em; text-transform: uppercase; margin-bottom: 12px;
  display: flex; align-items: center; gap: 8px;
}
.t-label::before { content:''; width:14px; height:1px; background:var(--gold); }

.t-main {
  font-family: 'Playfair Display', serif;
  font-size: 2.4em; font-weight: 700; line-height: 1;
  transition: color .4s;
  margin-bottom: 4px;
}
.t-main.up-t { color: var(--up); }
.t-main.dn-t { color: var(--down); }
.t-main.nu-t { color: var(--neutral); }

.t-sub {
  font-size: 0.7em; font-weight: 300; color: var(--text3);
  margin-bottom: 24px; font-style: italic;
}

.prob-wrap { margin-bottom: 20px; }
.prob-top {
  display: flex; justify-content: space-between;
  align-items: baseline; margin-bottom: 10px;
}
.prob-title { font-size: 0.62em; font-weight: 500; color: var(--text3); letter-spacing: 0.1em; }
.prob-num {
  font-family: 'Playfair Display', serif;
  font-size: 1.4em; font-weight: 700;
  transition: color .4s;
  font-variant-numeric: tabular-nums;
}
.prob-num.up-t { color: var(--up); }
.prob-num.dn-t { color: var(--down); }
.prob-num.nu-t { color: var(--neutral); }

.prob-track {
  height: 5px; background: var(--ink5); border-radius: 3px; overflow: hidden;
}
.prob-fill {
  height: 100%; border-radius: 3px;
  transition: width .9s cubic-bezier(.4,0,.2,1), background .4s;
}
.prob-fill.up-b { background: linear-gradient(90deg, rgba(78,202,139,.5), var(--up)); }
.prob-fill.dn-b { background: linear-gradient(90deg, rgba(224,92,107,.5), var(--down)); }
.prob-fill.nu-b { background: linear-gradient(90deg, rgba(123,156,196,.5), var(--neutral)); }

.score-row {
  display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 16px;
}
.score-box {
  background: var(--ink2); border: 1px solid var(--border2);
  border-radius: 12px; padding: 12px 14px;
}
.score-box.full { grid-column: 1/-1; }
.score-box-label {
  font-size: 0.55em; font-weight: 600; color: var(--text3);
  letter-spacing: 0.14em; text-transform: uppercase; margin-bottom: 6px;
}
.score-box-val {
  font-family: 'Playfair Display', serif;
  font-size: 1.15em; font-weight: 500;
}

/* ─── SIGNALS ────────────────────────────────────────────────────────── */
.signals-panel {
  background: var(--ink3); border: 1px solid var(--border2);
  border-radius: 20px; padding: 22px;
  margin-top: 14px;
  transition: border-color .3s;
}
.signals-panel:hover { border-color: var(--border); }

.sig-row {
  display: flex; align-items: center; justify-content: space-between;
  padding: 11px 0;
  border-bottom: 1px solid var(--border2);
  transition: all .2s;
}
.sig-row:last-child { border-bottom: none; }
.sig-row:hover { padding-left: 4px; }

.sig-info .sig-name { font-size: 0.75em; font-weight: 500; color: var(--text2); margin-bottom: 2px; }
.sig-info .sig-desc { font-size: 0.62em; color: var(--text3); }

.sig-chip {
  font-size: 0.62em; font-weight: 600;
  padding: 4px 12px; border-radius: 20px;
  letter-spacing: 0.05em; white-space: nowrap;
}
.sig-chip.b { background: var(--up-dim); color: var(--up); border: 1px solid rgba(78,202,139,.2); }
.sig-chip.s { background: var(--down-dim); color: var(--down); border: 1px solid rgba(224,92,107,.2); }
.sig-chip.n { background: var(--neutral-dim); color: var(--neutral); border: 1px solid rgba(123,156,196,.2); }

/* ─── NEWS ───────────────────────────────────────────────────────────── */
.news-panel {
  background: var(--ink3); border: 1px solid var(--border2);
  border-radius: 20px; padding: 24px;
  margin-top: 18px;
  transition: border-color .3s;
}
.news-panel:hover { border-color: var(--border); }

.ai-summary {
  background: var(--ink2);
  border-radius: 14px; padding: 18px 20px;
  margin: 14px 0;
  position: relative; overflow: hidden;
  border: 1px solid var(--border2);
  transition: border-color .4s;
}
.ai-summary.up  { border-left: 3px solid var(--up); }
.ai-summary.dn  { border-left: 3px solid var(--down); }
.ai-summary.neu { border-left: 3px solid var(--neutral); }

.ai-tag {
  font-size: 0.6em; font-weight: 600; letter-spacing: 0.12em;
  text-transform: uppercase; margin-bottom: 10px;
  display: flex; align-items: center; gap: 7px;
}
.ai-tag.up  { color: var(--up); }
.ai-tag.dn  { color: var(--down); }
.ai-tag.neu { color: var(--neutral); }

.ai-text {
  font-size: 0.78em; font-weight: 300;
  color: var(--text2); line-height: 1.75;
}
.ai-factors { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 10px; }
.ai-factor {
  background: var(--ink4); border: 1px solid var(--border2);
  border-radius: 6px; padding: 3px 10px;
  font-size: 0.6em; color: var(--text3); letter-spacing: 0.04em;
}

.news-list { display: flex; flex-direction: column; gap: 8px; }
.news-card {
  background: var(--ink2); border: 1px solid var(--border2);
  border-radius: 12px; padding: 14px 16px;
  transition: all .2s; cursor: pointer;
}
.news-card:hover {
  border-color: var(--border); background: var(--ink4);
  transform: translateX(3px);
}
.news-headline {
  font-size: 0.78em; font-weight: 500;
  color: var(--text); line-height: 1.5; margin-bottom: 6px;
}
.news-headline a { color: inherit; text-decoration: none; }
.news-headline a:hover { color: var(--gold-light); }
.news-byline {
  font-size: 0.6em; color: var(--text3);
  display: flex; gap: 10px;
}
.news-src { color: var(--gold); font-weight: 500; }

/* ─── LOADER ─────────────────────────────────────────────────────────── */
.loader {
  display: none; flex-direction: column;
  align-items: center; justify-content: center;
  padding: 80px 20px; gap: 20px;
}
.loader.on { display: flex; }
.loader-ring {
  width: 42px; height: 42px;
  border: 2px solid var(--ink5);
  border-top-color: var(--gold);
  border-radius: 50%;
  animation: spin .9s linear infinite;
  box-shadow: 0 0 16px rgba(200,169,110,.2);
}
@keyframes spin { to{transform:rotate(360deg)} }
.loader-label { font-size: 0.7em; font-weight: 300; color: var(--text3); letter-spacing: 0.2em; text-transform: uppercase; }

.err-notice {
  font-size: 0.7em; color: var(--down);
  background: var(--down-dim); border: 1px solid rgba(224,92,107,.2);
  border-radius: 10px; padding: 10px 16px;
  margin: 8px 0; display: none;
}
.err-notice.on { display: block; }

/* ─── REVEAL ANIMATIONS ──────────────────────────────────────────────── */
.fade { opacity: 0; animation: fadeUp .55s cubic-bezier(.4,0,.2,1) forwards; }
.d1 { animation-delay: .04s; }
.d2 { animation-delay: .09s; }
.d3 { animation-delay: .14s; }
.d4 { animation-delay: .19s; }
.d5 { animation-delay: .24s; }
@keyframes fadeUp { from{opacity:0;transform:translateY(16px)} to{opacity:1;transform:translateY(0)} }

/* ─── FOOTER ─────────────────────────────────────────────────────────── */
footer {
  margin-top: 40px; padding-top: 20px;
  border-top: 1px solid var(--border2);
  display: flex; justify-content: space-between; align-items: center;
  font-size: 0.62em; font-weight: 300;
  color: var(--text4); flex-wrap: wrap; gap: 8px;
}
.bull { color: var(--up); }
.bear { color: var(--down); }
.neut { color: var(--neutral); }

/* ─── NEWS HUB ─────────────────────────────────────────────────────── */
.news-hub {
  margin-top: 28px;
  background: var(--ink2);
  border: 1px solid var(--border2);
  border-radius: 24px;
  overflow: hidden;
  transition: border-color .3s;
}
.news-hub:hover { border-color: var(--border); }

.news-hub-header {
  display: flex; align-items: center; justify-content: space-between;
  padding: 22px 28px 0; flex-wrap: wrap; gap: 12px;
}
.news-hub-title {
  font-family: 'Playfair Display', serif;
  font-size: 1.15em; font-weight: 700; color: var(--gold-light);
  display: flex; align-items: center; gap: 10px;
}
.news-hub-title::before {
  content: ''; width: 3px; height: 18px;
  background: linear-gradient(180deg, var(--gold-light), var(--gold));
  border-radius: 2px; display: block;
}
.hub-meta { font-size: .65em; color: var(--text3); font-weight: 300; }
.hub-refresh-btn {
  background: transparent; border: 1px solid var(--border2);
  border-radius: 8px; padding: 5px 14px; color: var(--text3);
  font-family: 'Outfit', sans-serif; font-size: .68em; font-weight: 500;
  cursor: pointer; letter-spacing: .05em; transition: all .2s;
}
.hub-refresh-btn:hover { color: var(--gold); border-color: var(--gold); }
.hub-refresh-btn:disabled { opacity: .35; cursor: not-allowed; }

.news-tabs {
  display: flex; gap: 0; padding: 16px 28px 0;
  border-bottom: 1px solid var(--border2); flex-wrap: wrap;
}
.news-tab {
  padding: 8px 18px 11px; font-size: .72em; font-weight: 500;
  color: var(--text3); cursor: pointer;
  border-bottom: 2px solid transparent;
  transition: all .2s; white-space: nowrap;
  display: flex; align-items: center; gap: 6px;
}
.news-tab:hover { color: var(--text2); }
.news-tab.active { color: var(--gold-light); border-bottom-color: var(--gold); }
.news-tab .tab-count {
  background: var(--ink4); border: 1px solid var(--border2);
  border-radius: 10px; padding: 1px 7px;
  font-size: .82em; color: var(--text3); transition: all .2s;
}
.news-tab.active .tab-count { background: var(--gold-dim); color: var(--gold); border-color: var(--gold); }

.news-grid-wrap { padding: 22px 28px 26px; }
.news-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(290px, 1fr));
  gap: 12px;
}

.news-article {
  background: var(--ink3); border: 1px solid var(--border2);
  border-radius: 14px; padding: 16px 18px;
  transition: all .25s cubic-bezier(.4,0,.2,1);
  display: flex; flex-direction: column; gap: 8px;
  position: relative; overflow: hidden;
}
.news-article::before {
  content: ''; position: absolute;
  left: 0; top: 0; bottom: 0; width: 3px;
  background: var(--gold); opacity: 0; transition: opacity .2s;
}
.news-article:hover { border-color: var(--border); transform: translateY(-2px); box-shadow: 0 8px 28px rgba(0,0,0,.25); }
.news-article:hover::before { opacity: 1; }

.art-source-row { display: flex; align-items: center; justify-content: space-between; gap: 8px; }
.art-source {
  font-size: .6em; font-weight: 600;
  letter-spacing: .1em; text-transform: uppercase;
  padding: 2px 9px; border-radius: 20px;
}
.src-crypto  { color: #7eb8ff; background: rgba(126,184,255,.1); border: 1px solid rgba(126,184,255,.2); }
.src-macro   { color: var(--gold); background: var(--gold-dim); border: 1px solid rgba(200,169,110,.2); }
.src-fed     { color: #c4a0ff; background: rgba(196,160,255,.08); border: 1px solid rgba(196,160,255,.2); }
.src-markets { color: var(--up); background: var(--up-dim); border: 1px solid rgba(78,202,139,.2); }

.art-age { font-size: .6em; color: var(--text3); }
.art-headline { font-size: .82em; font-weight: 500; color: var(--text); line-height: 1.5; }
.art-headline a { color: inherit; text-decoration: none; transition: color .2s; }
.art-headline a:hover { color: var(--gold-light); }
.art-snippet {
  font-size: .7em; font-weight: 300; color: var(--text3); line-height: 1.6;
  display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;
}
.art-sentiment { display: flex; align-items: center; gap: 5px; font-size: .62em; font-weight: 600; margin-top: 2px; }
.sent-bull { color: var(--up); } .sent-bear { color: var(--down); } .sent-neut { color: var(--neutral); }

.market-ticker {
  display: flex; border-top: 1px solid var(--border2);
  overflow-x: auto; scrollbar-width: none;
}
.market-ticker::-webkit-scrollbar { display: none; }
.ticker-cell {
  padding: 12px 22px; border-right: 1px solid var(--border2);
  white-space: nowrap; flex-shrink: 0; transition: background .2s; cursor: default;
}
.ticker-cell:hover { background: var(--gold-dim); }
.ticker-name { font-size: .58em; font-weight: 600; color: var(--text3); letter-spacing: .1em; text-transform: uppercase; margin-bottom: 3px; }
.ticker-val { font-size: .88em; font-weight: 500; color: var(--text); font-variant-numeric: tabular-nums; }
.ticker-chg { font-size: .65em; font-weight: 500; font-variant-numeric: tabular-nums; }

.econ-strip {
  border-top: 1px solid var(--border2); padding: 14px 28px;
  display: flex; gap: 10px; overflow-x: auto; scrollbar-width: none;
}
.econ-strip::-webkit-scrollbar { display: none; }
.econ-event {
  background: var(--ink3); border: 1px solid var(--border2);
  border-radius: 10px; padding: 10px 14px;
  flex-shrink: 0; min-width: 175px; transition: border-color .2s;
}
.econ-event:hover { border-color: var(--border); }
.econ-event-time { font-size: .58em; color: var(--text3); letter-spacing: .06em; margin-bottom: 3px; }
.econ-event-name { font-size: .72em; font-weight: 500; color: var(--text2); margin-bottom: 5px; line-height: 1.4; }
.econ-event-imp { font-size: .58em; font-weight: 600; padding: 1px 7px; border-radius: 8px; display: inline-block; }
.imp-high { background: rgba(224,92,107,.12); color: var(--down); border: 1px solid rgba(224,92,107,.25); }
.imp-med  { background: rgba(255,184,48,.1); color: #ffb830; border: 1px solid rgba(255,184,48,.2); }
.imp-low  { background: var(--neutral-dim); color: var(--neutral); border: 1px solid rgba(123,156,196,.2); }

.hub-loading {
  display: flex; align-items: center; justify-content: center;
  gap: 10px; padding: 40px 20px; font-size: .75em; color: var(--text3);
}
.hub-spinner {
  width: 16px; height: 16px; border: 2px solid var(--ink5);
  border-top-color: var(--gold); border-radius: 50%;
  animation: spin .8s linear infinite;
}
.hub-empty { text-align: center; padding: 36px 20px; font-size: .75em; color: var(--text3); font-style: italic; }
</style>
</head>
<body>

<div class="bg-layer"></div>
<div class="grain"></div>

<div class="wrap">

  <!-- NAV -->
  <nav>
    <div class="brand">
      <span class="brand-name">Aurum</span>
      <div class="brand-dot"></div>
      <span class="brand-tagline">Crypto Intelligence</span>
    </div>
    <div class="nav-right">
      <div class="live-chip"><div class="live-dot"></div> Live · CoinGecko</div>
      <div class="clock" id="clock">--:--:--</div>
      <button class="btn-refresh" id="btnRefresh" onclick="refreshAll()">↻ Aktualisieren</button>
    </div>
  </nav>

  <!-- API KEY -->
  <div class="api-row">
    <span class="api-label">Claude API</span>
    <input type="password" class="api-field" id="apiKey" placeholder="sk-ant-api03-···  (optional, für KI News-Analyse)">
    <span class="api-note">Ohne Key: nur technische Analyse aktiv</span>
  </div>

  <!-- COIN PILLS -->
  <div class="coin-row" id="coinRow">
    <button class="coin-pill active" onclick="selectCoin('bitcoin')" id="tab-bitcoin">
      <div class="coin-icon">₿</div>
      <div class="coin-info">
        <div class="coin-sym">Bitcoin</div>
        <div class="coin-price" id="price-bitcoin">$–</div>
        <div class="coin-chg" id="chg-bitcoin">–</div>
      </div>
    </button>
    <button class="coin-pill" onclick="selectCoin('ethereum')" id="tab-ethereum">
      <div class="coin-icon">Ξ</div>
      <div class="coin-info">
        <div class="coin-sym">Ethereum</div>
        <div class="coin-price" id="price-ethereum">$–</div>
        <div class="coin-chg" id="chg-ethereum">–</div>
      </div>
    </button>
    <button class="coin-pill" onclick="selectCoin('solana')" id="tab-solana">
      <div class="coin-icon">◎</div>
      <div class="coin-info">
        <div class="coin-sym">Solana</div>
        <div class="coin-price" id="price-solana">$–</div>
        <div class="coin-chg" id="chg-solana">–</div>
      </div>
    </button>
    <button class="coin-pill" onclick="selectCoin('ripple')" id="tab-ripple">
      <div class="coin-icon">✕</div>
      <div class="coin-info">
        <div class="coin-sym">XRP</div>
        <div class="coin-price" id="price-ripple">$–</div>
        <div class="coin-chg" id="chg-ripple">–</div>
      </div>
    </button>
  </div>

  <!-- CONTROLS -->
  <div class="ctrl-bar">
    <span class="ctrl-label">Zeitraum</span>
    <button class="tf-btn" onclick="setTF('10m')" id="tf-10m">10 Min</button>
    <button class="tf-btn active" onclick="setTF('15m')" id="tf-15m">15 Min</button>
    <button class="tf-btn" onclick="setTF('30m')" id="tf-30m">30 Min</button>
    <button class="tf-btn" onclick="setTF('1h')" id="tf-1h">1 Stunde ★</button>
    <div class="sep"></div>
    <div class="weight-ctrl">
      <span>Technik</span>
      <input type="range" id="wSlider" min="30" max="80" value="60" step="10">
      <span class="hi" id="wTech">60%</span>
      <span>· News</span>
      <span class="hi" id="wNews">40%</span>
    </div>
    <div class="demo-tag" id="demoTag">Demo-Modus</div>
  </div>

  <!-- LOADER -->
  <div class="loader" id="loader">
    <div class="loader-ring"></div>
    <div class="loader-label">Marktdaten werden geladen</div>
  </div>

  <div class="err-notice" id="errNotice"></div>

  <!-- MAIN CONTENT -->
  <div id="content" style="display:none;">
    <div class="grid">

      <!-- LEFT -->
      <div>

        <!-- Chart Card -->
        <div class="card fade d1">
          <div class="price-head">
            <div class="price-left">
              <div class="coin-label" id="coinLabel">BITCOIN · BTC / USD</div>
              <div class="price-big" id="priceBig">$–</div>
              <div id="priceBadge" class="price-change-badge up">–</div>
            </div>
            <div class="price-right">
              <div class="timeframe-label">Zeitrahmen</div>
              <div class="tf-btn active" style="cursor:default;pointer-events:none;" id="tfDisplay">15 Min</div>
            </div>
          </div>
          <div class="chart-area">
            <canvas id="cPrice" height="190"></canvas>
            <canvas id="cRsi"   height="62" style="margin-top:8px;"></canvas>
            <canvas id="cMacd"  height="62" style="margin-top:8px;"></canvas>
          </div>
          <div class="ind-strip">
            <div class="ind-cell">
              <div class="ind-cell-label">EMA 9 / 21</div>
              <div class="ind-cell-val" id="iEmaV">–</div>
              <div class="ind-cell-sig" id="iEmaS">–</div>
            </div>
            <div class="ind-cell">
              <div class="ind-cell-label">RSI (14)</div>
              <div class="ind-cell-val" id="iRsiV">–</div>
              <div class="ind-cell-sig" id="iRsiS">–</div>
            </div>
            <div class="ind-cell">
              <div class="ind-cell-label">MACD</div>
              <div class="ind-cell-val" id="iMacdV">–</div>
              <div class="ind-cell-sig" id="iMacdS">–</div>
            </div>
          </div>
        </div>

        <!-- News Panel -->
        <div class="news-panel fade d4">
          <div class="section-title">Nachrichten · Claude Sentiment</div>
          <div id="aiBlock"></div>
          <div class="news-list" id="newsList">
            <div style="font-size:.72em;color:var(--text3);padding:10px 0;font-weight:300;font-style:italic;">
              Bitte Anthropic API Key eingeben, um KI-Analyse zu aktivieren…
            </div>
          </div>
        </div>

      </div><!-- /left -->

      <!-- RIGHT -->
      <div style="display:flex;flex-direction:column;gap:14px;">

        <!-- Trend Card -->
        <div class="trend-panel" id="trendPanel">
          <div class="trend-glow"></div>
          <div class="t-label">Tagestrend Prognose</div>
          <div class="t-main nu-t" id="tMain">Analysiere…</div>
          <div class="t-sub" id="tSub">Berechnung läuft…</div>

          <div class="prob-wrap">
            <div class="prob-top">
              <span class="prob-title">Eintrittswahrscheinlichkeit</span>
              <span class="prob-num nu-t" id="probNum">–%</span>
            </div>
            <div class="prob-track">
              <div class="prob-fill nu-b" id="probFill" style="width:0%"></div>
            </div>
          </div>

          <div class="score-row">
            <div class="score-box">
              <div class="score-box-label">Technik</div>
              <div class="score-box-val" id="sTech">–</div>
            </div>
            <div class="score-box">
              <div class="score-box-label">News</div>
              <div class="score-box-val" id="sNews">–</div>
            </div>
            <div class="score-box full">
              <div class="score-box-label">Gesamt-Score</div>
              <div class="score-box-val" id="sCombined">–</div>
            </div>
          </div>
        </div>

        <!-- Signals -->
        <div class="signals-panel fade d3">
          <div class="section-title" style="margin-bottom:14px;">Signale im Detail</div>
          <div id="sigList"></div>
        </div>

      </div><!-- /right -->
    </div><!-- /grid -->
  </div><!-- /content -->

  <!-- ══ NEWS HUB ══════════════════════════════════════════════════════ -->
  <div class="news-hub" id="newsHub">

    <!-- Header -->
    <div class="news-hub-header">
      <div>
        <div class="news-hub-title">Markt & Nachrichten</div>
        <div class="hub-meta" id="hubMeta">Lade Nachrichten…</div>
      </div>
      <button class="hub-refresh-btn" id="hubRefreshBtn" onclick="refreshHub()">↻ Aktualisieren</button>
    </div>

    <!-- Market Ticker -->
    <div class="market-ticker" id="marketTicker">
      <div class="ticker-cell"><div class="ticker-name">S&amp;P 500</div><div class="ticker-val" id="tk-sp500">–</div><div class="ticker-chg" id="tc-sp500">–</div></div>
      <div class="ticker-cell"><div class="ticker-name">Nasdaq</div><div class="ticker-val" id="tk-nasdaq">–</div><div class="ticker-chg" id="tc-nasdaq">–</div></div>
      <div class="ticker-cell"><div class="ticker-name">Gold</div><div class="ticker-val" id="tk-gold">–</div><div class="ticker-chg" id="tc-gold">–</div></div>
      <div class="ticker-cell"><div class="ticker-name">Öl (WTI)</div><div class="ticker-val" id="tk-oil">–</div><div class="ticker-chg" id="tc-oil">–</div></div>
      <div class="ticker-cell"><div class="ticker-name">EUR/USD</div><div class="ticker-val" id="tk-eurusd">–</div><div class="ticker-chg" id="tc-eurusd">–</div></div>
      <div class="ticker-cell"><div class="ticker-name">BTC Dom.</div><div class="ticker-val" id="tk-btcdom">–</div><div class="ticker-chg" id="tc-btcdom">–</div></div>
      <div class="ticker-cell"><div class="ticker-name">Fear &amp; Greed</div><div class="ticker-val" id="tk-fng">–</div><div class="ticker-chg" id="tc-fng" style="font-size:.62em;color:var(--text3);">–</div></div>
    </div>

    <!-- Category Tabs -->
    <div class="news-tabs">
      <div class="news-tab active" onclick="switchTab('all')" id="ntab-all">Alle <span class="tab-count" id="cnt-all">0</span></div>
      <div class="news-tab" onclick="switchTab('crypto')" id="ntab-crypto">Crypto <span class="tab-count" id="cnt-crypto">0</span></div>
      <div class="news-tab" onclick="switchTab('macro')" id="ntab-macro">Makro &amp; Wirtschaft <span class="tab-count" id="cnt-macro">0</span></div>
      <div class="news-tab" onclick="switchTab('fed')" id="ntab-fed">Fed &amp; Zinsen <span class="tab-count" id="cnt-fed">0</span></div>
      <div class="news-tab" onclick="switchTab('markets')" id="ntab-markets">Märkte <span class="tab-count" id="cnt-markets">0</span></div>
    </div>

    <!-- Economic Calendar -->
    <div class="econ-strip" id="econStrip">
      <div style="font-size:.65em;color:var(--text3);display:flex;align-items:center;gap:6px;padding:4px 0;">
        <span style="font-weight:600;color:var(--gold);">Wirtschaftskalender</span>
      </div>
    </div>

    <!-- News Grid -->
    <div class="news-grid-wrap">
      <div class="hub-loading" id="hubLoading">
        <div class="hub-spinner"></div>
        <span>Nachrichten werden geladen…</span>
      </div>
      <div class="news-grid" id="newsGrid" style="display:none;"></div>
      <div class="hub-empty" id="hubEmpty" style="display:none;">Keine Nachrichten für diese Kategorie verfügbar.</div>
    </div>

  </div><!-- /news-hub -->

  <footer>
    <span>Aurum Crypto Intelligence · Kurse: CoinGecko · News: öffentliche RSS-Feeds · KI: Claude claude-opus-4-6</span>
    <span>⚠ Keine Anlageberatung — Handel auf eigenes Risiko</span>
  </footer>

</div><!-- /wrap -->

<script>
// ═══════════════════════════════════════════════════════════════════════
// CONFIG
// ═══════════════════════════════════════════════════════════════════════
const COINS = {
  bitcoin:  {sym:'BTC', name:'Bitcoin',  icon:'₿',  cg:'bitcoin'},
  ethereum: {sym:'ETH', name:'Ethereum', icon:'Ξ',  cg:'ethereum'},
  solana:   {sym:'SOL', name:'Solana',   icon:'◎', cg:'solana'},
  ripple:   {sym:'XRP', name:'XRP',      icon:'✕', cg:'ripple'},
};
const TERMS = {
  bitcoin:['bitcoin','btc'], ethereum:['ethereum','eth'],
  solana:['solana','sol'],   ripple:['xrp','ripple'],
};
const FEEDS = [
  {url:'https://cointelegraph.com/rss', name:'CoinTelegraph'},
  {url:'https://decrypt.co/feed',       name:'Decrypt'},
  {url:'https://cryptoslate.com/feed/', name:'CryptoSlate'},
];
const PROXY = [
  u=>`https://api.allorigins.win/raw?url=${encodeURIComponent(u)}`,
  u=>`https://corsproxy.io/?${encodeURIComponent(u)}`,
];
const TF_LABELS = {'10m':'10 Min','15m':'15 Min','30m':'30 Min','1h':'1 Stunde ★'};

let coin = 'bitcoin', tf = '15m', techW = 0.6;
let ts = 50, ns = 50;
let cP=null, cR=null, cM=null;

// Clock
setInterval(()=>{
  document.getElementById('clock').textContent =
    new Date().toLocaleTimeString('de-DE',{hour12:false});
},1000);

// Slider
const wSlider = document.getElementById('wSlider');
wSlider.addEventListener('input', e=>{
  techW = parseInt(e.target.value)/100;
  document.getElementById('wTech').textContent = e.target.value+'%';
  document.getElementById('wNews').textContent = (100-parseInt(e.target.value))+'%';
  // Update range fill
  wSlider.style.background = `linear-gradient(90deg, var(--gold) ${e.target.value}%, var(--ink5) ${e.target.value}%)`;
  computeTrend(ts, ns);
});

// ═══════════════════════════════════════════════════════════════════════
// DATA FETCHING
// ═══════════════════════════════════════════════════════════════════════
async function getCGOHLC(cg, days=1) {
  const r = await fetch(`https://api.coingecko.com/api/v3/coins/${cg}/ohlc?vs_currency=usd&days=${days}`);
  if(!r.ok) throw new Error(`CoinGecko ${r.status}`);
  const d = await r.json();
  if(!Array.isArray(d)||d.length===0) throw new Error('Leere Antwort');
  return d.map(([t,o,h,l,c])=>({time:new Date(t),open:o,high:h,low:l,close:c,vol:400+Math.random()*800}));
}

async function getCGPrice(cg) {
  const r = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${cg}&vs_currencies=usd&include_24hr_change=true`);
  if(!r.ok) return null;
  return (await r.json())[cg]||null;
}

function demoData(base, n) {
  let p=base; const now=Date.now(), ms=1800000;
  return Array.from({length:n},(_,i)=>{
    const d=(Math.random()-.46)*base*.009, o=p, c=Math.max(o+d,.001);
    const h=Math.max(o,c)*(1+Math.random()*.003), l=Math.min(o,c)*(1-Math.random()*.003);
    p=c; return {time:new Date(now-(n-i)*ms),open:o,high:h,low:l,close:c,vol:300+Math.random()*700};
  });
}

function slice(raw, tf) {
  const n={'10m':24,'15m':32,'30m':48,'1h':24}[tf]||32;
  return raw.slice(-n);
}

// ═══════════════════════════════════════════════════════════════════════
// INDICATORS
// ═══════════════════════════════════════════════════════════════════════
const ema=(a,p)=>{const k=2/(p+1);let r=[a[0]];for(let i=1;i<a.length;i++)r.push(a[i]*k+r[i-1]*(1-k));return r;};

function rsi14(cls){
  const p=14; let g=[],l=[];
  for(let i=1;i<cls.length;i++){const d=cls[i]-cls[i-1];g.push(d>0?d:0);l.push(d<0?-d:0);}
  let r=Array(p).fill(null);
  let ag=g.slice(0,p).reduce((a,b)=>a+b,0)/p, al=l.slice(0,p).reduce((a,b)=>a+b,0)/p;
  r.push(100-100/(1+ag/(al||1e-9)));
  for(let i=p;i<g.length;i++){ag=(ag*13+g[i])/14;al=(al*13+l[i])/14;r.push(100-100/(1+ag/(al||1e-9)));}
  return r;
}

function calcMACD(cls){
  const e12=ema(cls,12),e26=ema(cls,26);
  const m=cls.map((_,i)=>e12[i]-e26[i]), s=ema(m,9);
  return{macd:m,signal:s,hist:m.map((v,i)=>v-s[i])};
}

function calcBB(cls){
  return cls.map((_,i)=>{
    if(i<19)return{u:null,l:null,m:null};
    const sl=cls.slice(i-19,i+1), mean=sl.reduce((a,b)=>a+b,0)/20;
    const std=Math.sqrt(sl.reduce((a,b)=>a+(b-mean)**2,0)/20);
    return{u:mean+2*std,l:mean-2*std,m:mean};
  });
}

function indicators(candles){
  const cls=candles.map(c=>c.close);
  const e9=ema(cls,9), e21=ema(cls,21);
  const rsiArr=rsi14(cls);
  const {macd,signal,hist}=calcMACD(cls);
  const bbArr=calcBB(cls);
  const i=candles.length-1;
  let sigs=[], sc=50;

  const eb=e9[i]>e21[i]; sc+=eb?8:-8;
  sigs.push({n:'EMA 9/21', d:eb?'Golden Cross':'Death Cross', t:eb?'b':'s', v:eb?'+8':'-8'});

  const rv=rsiArr[i]||50;
  if(rv<35){sc+=12;sigs.push({n:'RSI',d:`Überverkauft · ${rv.toFixed(0)}`,t:'b',v:'+12'});}
  else if(rv>65){sc-=12;sigs.push({n:'RSI',d:`Überkauft · ${rv.toFixed(0)}`,t:'s',v:'-12'});}
  else if(rv>45&&rv<60){sc+=5;sigs.push({n:'RSI',d:`Bullish Zone · ${rv.toFixed(0)}`,t:'b',v:'+5'});}
  else sigs.push({n:'RSI',d:`Neutral · ${rv.toFixed(0)}`,t:'n',v:'0'});

  const mb=macd[i]>signal[i]&&hist[i]>0, mbe=macd[i]<signal[i]&&hist[i]<0;
  if(mb){sc+=10;sigs.push({n:'MACD',d:'Bullish Divergenz',t:'b',v:'+10'});}
  else if(mbe){sc-=10;sigs.push({n:'MACD',d:'Bearish Divergenz',t:'s',v:'-10'});}
  else sigs.push({n:'MACD',d:'Kein klares Signal',t:'n',v:'0'});

  const bb=bbArr[i];
  if(bb&&bb.u){
    const pos=(cls[i]-bb.l)/(bb.u-bb.l||.001);
    if(pos<.2){sc+=8;sigs.push({n:'Bollinger',d:'Nahe Lower Band',t:'b',v:'+8'});}
    else if(pos>.8){sc-=8;sigs.push({n:'Bollinger',d:'Nahe Upper Band',t:'s',v:'-8'});}
    else sigs.push({n:'Bollinger',d:`Mid Band · ${(pos*100).toFixed(0)}%`,t:'n',v:'0'});
  }

  const vsma=candles.slice(-20).reduce((a,b)=>a+b.vol,0)/20;
  if(candles[i].vol>vsma*1.3){
    const vb=cls[i]>candles[i].open; sc+=vb?7:-7;
    sigs.push({n:'Volumen',d:vb?'Hohes Volumen · Bullish':'Hohes Volumen · Bearish',t:vb?'b':'s',v:vb?'+7':'-7'});
  } else sigs.push({n:'Volumen',d:'Normales Volumen',t:'n',v:'0'});

  if(candles.length>=4){
    const mom=(cls[i]-cls[i-3])/cls[i-3]*100;
    if(mom>.5){sc+=5;sigs.push({n:'Momentum',d:`+${mom.toFixed(2)}% · letzte 3 Kerzen`,t:'b',v:'+5'});}
    else if(mom<-.5){sc-=5;sigs.push({n:'Momentum',d:`${mom.toFixed(2)}% · letzte 3 Kerzen`,t:'s',v:'-5'});}
    else sigs.push({n:'Momentum',d:`${mom.toFixed(2)}% · seitwärts`,t:'n',v:'0'});
  }

  sc=Math.max(0,Math.min(100,sc));
  return{sc,trend:sc>=60?'BULLISH':sc<=40?'BEARISH':'NEUTRAL',sigs,rv,eb,mb,mbe,e9,e21,rsiArr,macd,signal,hist,bbArr};
}

// ═══════════════════════════════════════════════════════════════════════
// TREND UI
// ═══════════════════════════════════════════════════════════════════════
function computeTrend(techScore, newsScore){
  const c=Math.round(techScore*techW + newsScore*(1-techW));
  let tr, prob;
  if(c>=62){tr='BULLISH';prob=Math.min(85,40+(c-62)*1.5);}
  else if(c<=38){tr='BEARISH';prob=Math.min(85,40+(38-c)*1.5);}
  else{tr='NEUTRAL';prob=Math.min(85,30+Math.abs(c-50)*.5);}
  prob=Math.round(prob);

  const isUp=tr==='BULLISH', isDn=tr==='BEARISH';
  const tc=isUp?'up-t':isDn?'dn-t':'nu-t';
  const bc=isUp?'up-b':isDn?'dn-b':'nu-b';
  const pc=isUp?'up':isDn?'dn':'neut';
  const sub=isUp?'Steigende Dynamik erkannt':isDn?'Fallende Dynamik erkannt':'Unklare Marktlage';
  const icon=isUp?'↑':isDn?'↓':'→';

  document.getElementById('tMain').textContent=icon+' '+tr;
  document.getElementById('tMain').className='t-main '+tc;
  document.getElementById('tSub').textContent=sub;
  document.getElementById('trendPanel').className='trend-panel '+(isUp?'':isDn?'bear':'neut');
  document.getElementById('probNum').textContent=prob+'%';
  document.getElementById('probNum').className='prob-num '+tc;
  document.getElementById('probFill').style.width=prob+'%';
  document.getElementById('probFill').className='prob-fill '+bc;

  const vClass=isUp?'bull':isDn?'bear':'neut';
  document.getElementById('sTech').textContent=techScore+' / 100';
  document.getElementById('sTech').className='score-box-val '+vClass;
  document.getElementById('sNews').textContent=newsScore+' / 100';
  document.getElementById('sNews').className='score-box-val '+vClass;
  document.getElementById('sCombined').textContent=c+' / 100';
  document.getElementById('sCombined').className='score-box-val '+vClass;
}

// ═══════════════════════════════════════════════════════════════════════
// CHARTS
// ═══════════════════════════════════════════════════════════════════════
Chart.defaults.color='#6b5e4e';
Chart.defaults.borderColor='rgba(200,169,110,0.07)';
Chart.defaults.font.family='Outfit';
Chart.defaults.font.size=10;

const tipOptions = {
  backgroundColor:'rgba(22,20,16,.96)',
  borderColor:'rgba(200,169,110,0.2)',
  borderWidth:1, titleColor:'#a89880', bodyColor:'#f0ead8', padding:12,
  cornerRadius:10,
};

function buildCharts(candles, ind){
  const labels=candles.map(c=>{const d=c.time;return `${d.getHours().toString().padStart(2,'0')}:${d.getMinutes().toString().padStart(2,'0')}`;});
  const cls=candles.map(c=>c.close);
  const up='rgba(78,202,139,0.65)', dn='rgba(224,92,107,0.65)';
  const barC=candles.map(c=>c.close>=c.open?up:dn);

  [cP,cR,cM].forEach(c=>c?.destroy());

  // Price chart
  cP = new Chart(document.getElementById('cPrice'),{
    type:'bar',
    data:{labels,datasets:[
      {label:'Preis',data:cls,backgroundColor:barC,borderColor:barC,borderWidth:1,barPercentage:.6},
      {label:'EMA 9',data:ind.e9,type:'line',borderColor:'rgba(200,169,110,.7)',borderWidth:1.5,pointRadius:0,tension:.15,borderDash:[5,4]},
      {label:'EMA 21',data:ind.e21,type:'line',borderColor:'rgba(200,120,60,.7)',borderWidth:1.5,pointRadius:0,tension:.15},
      {label:'BB +2σ',data:ind.bbArr.map(b=>b.u),type:'line',borderColor:'rgba(123,156,196,.2)',borderWidth:1,pointRadius:0,fill:false},
      {label:'BB −2σ',data:ind.bbArr.map(b=>b.l),type:'line',borderColor:'rgba(123,156,196,.2)',borderWidth:1,pointRadius:0,fill:'-1',backgroundColor:'rgba(123,156,196,0.03)'},
    ]},
    options:{
      responsive:true, animation:{duration:500},
      plugins:{legend:{labels:{boxWidth:10,padding:12,color:'#a89880'}},tooltip:{...tipOptions}},
      scales:{
        x:{grid:{display:false},ticks:{color:'#6b5e4e',maxTicksLimit:8}},
        y:{grid:{color:'rgba(200,169,110,.05)'},position:'right',ticks:{color:'#a89880',callback:v=>v>999?'$'+(v/1000).toFixed(1)+'k':'$'+v.toFixed(2)}},
      },
    },
  });

  // RSI
  cR = new Chart(document.getElementById('cRsi'),{
    type:'line',
    data:{labels,datasets:[{label:'RSI',data:ind.rsiArr,borderColor:'#7b9cc4',backgroundColor:'rgba(123,156,196,0.06)',borderWidth:1.5,pointRadius:0,tension:.3,fill:true}]},
    options:{
      responsive:true, animation:{duration:500},
      plugins:{legend:{display:false},tooltip:{...tipOptions}},
      scales:{x:{display:false},y:{min:0,max:100,grid:{color:'rgba(200,169,110,.05)'},position:'right',ticks:{color:'#6b5e4e',stepSize:25}}},
    },
  });

  // MACD
  const hC=ind.hist.map(v=>v>=0?'rgba(78,202,139,.45)':'rgba(224,92,107,.45)');
  cM = new Chart(document.getElementById('cMacd'),{
    type:'bar',
    data:{labels,datasets:[
      {label:'Hist',data:ind.hist,backgroundColor:hC,borderWidth:0,barPercentage:.8},
      {label:'MACD',data:ind.macd,type:'line',borderColor:'#7b9cc4',borderWidth:1.5,pointRadius:0,tension:.15},
      {label:'Signal',data:ind.signal,type:'line',borderColor:'rgba(200,120,60,.6)',borderWidth:1.5,borderDash:[5,4],pointRadius:0,tension:.15},
    ]},
    options:{
      responsive:true, animation:{duration:500},
      plugins:{legend:{display:false},tooltip:{...tipOptions}},
      scales:{x:{display:false},y:{grid:{color:'rgba(200,169,110,.05)'},position:'right',ticks:{color:'#6b5e4e'}}},
    },
  });
}

function updateInds(ind, candles){
  const i=candles.length-1;
  const ec=ind.eb?'bull':'bear';
  document.getElementById('iEmaV').textContent=`${ind.e9[i].toFixed(2)} / ${ind.e21[i].toFixed(2)}`;
  document.getElementById('iEmaV').className='ind-cell-val '+ec;
  document.getElementById('iEmaS').textContent=ind.eb?'↑ Golden Cross':'↓ Death Cross';
  document.getElementById('iEmaS').className='ind-cell-sig '+ec;

  const rc=ind.rv<35?'bull':ind.rv>65?'bear':'neut';
  document.getElementById('iRsiV').textContent=ind.rv.toFixed(1);
  document.getElementById('iRsiV').className='ind-cell-val '+rc;
  document.getElementById('iRsiS').textContent=ind.rv<35?'↑ Überverkauft':ind.rv>65?'↓ Überkauft':'→ Neutral';
  document.getElementById('iRsiS').className='ind-cell-sig '+rc;

  const mc=ind.mb?'bull':ind.mbe?'bear':'neut';
  document.getElementById('iMacdV').textContent=(ind.macd[i]||0).toFixed(5);
  document.getElementById('iMacdV').className='ind-cell-val '+mc;
  document.getElementById('iMacdS').textContent=ind.mb?'↑ Bullish':ind.mbe?'↓ Bearish':'→ Neutral';
  document.getElementById('iMacdS').className='ind-cell-sig '+mc;
}

function renderSigs(sigs){
  document.getElementById('sigList').innerHTML=sigs.map(s=>`
    <div class="sig-row">
      <div class="sig-info">
        <div class="sig-name">${s.n}</div>
        <div class="sig-desc">${s.d}</div>
      </div>
      <span class="sig-chip ${s.t}">${s.t==='b'?'Bullish':s.t==='s'?'Bearish':'Neutral'} ${s.v}</span>
    </div>`).join('');
}

// ═══════════════════════════════════════════════════════════════════════
// NEWS + CLAUDE
// ═══════════════════════════════════════════════════════════════════════
async function proxyFetch(url){
  for(const p of PROXY){
    try{const r=await fetch(p(url),{signal:AbortSignal.timeout(7000)});if(r.ok)return await r.text();}catch{}
  }
  return null;
}

async function getNews(coinId){
  const terms=TERMS[coinId]||[coinId];
  const arts=[];
  for(const src of FEEDS){
    const txt=await proxyFetch(src.url); if(!txt) continue;
    const doc=new DOMParser().parseFromString(txt,'text/xml');
    for(const item of Array.from(doc.querySelectorAll('item')).slice(0,20)){
      const t=item.querySelector('title')?.textContent||'';
      const d=item.querySelector('description')?.textContent?.replace(/<[^>]+>/g,'')||'';
      const l=item.querySelector('link')?.textContent||'';
      const pub=item.querySelector('pubDate')?.textContent?.slice(0,16)||'';
      if(terms.some(x=>(t+' '+d).toLowerCase().includes(x)))
        arts.push({title:t,link:l,pub,src:src.name});
    }
  }
  return arts.slice(0,5);
}

async function claudeAI(key, name, arts){
  if(!arts.length) return{trend:'NEUTRAL',score:50,reasoning:'Keine aktuellen News gefunden.',confidence:0,key_factors:[]};
  const hl=arts.map(a=>`- ${a.title} (${a.src})`).join('\n');
  const p=`Analysiere diese Krypto-Schlagzeilen für ${name}:\n\n${hl}\n\nAntworte NUR mit JSON (kein Markdown):\n{"trend":"BULLISH"|"BEARISH"|"NEUTRAL","score":<0-100>,"confidence":<0-100>,"reasoning":"<2-3 Sätze auf Deutsch>","key_factors":["f1","f2","f3"]}`;
  try{
    const r=await fetch('https://api.anthropic.com/v1/messages',{
      method:'POST',
      headers:{'Content-Type':'application/json','x-api-key':key,'anthropic-version':'2023-06-01','anthropic-dangerous-direct-browser-access':'true'},
      body:JSON.stringify({model:'claude-opus-4-6',max_tokens:400,messages:[{role:'user',content:p}]}),
    });
    if(!r.ok){const e=await r.json();throw new Error(e.error?.message||'Fehler');}
    const data=await r.json();
    let raw=data.content[0].text.trim();
    if(raw.includes('```')) raw=raw.replace(/```json|```/g,'').trim();
    return JSON.parse(raw);
  }catch(e){return{trend:'NEUTRAL',score:50,reasoning:`Fehler: ${e.message}`,confidence:0,key_factors:[]};}
}

function renderNews(arts, sent){
  const tl=(sent.trend||'NEUTRAL').toLowerCase()==='bullish'?'up':(sent.trend||'NEUTRAL').toLowerCase()==='bearish'?'dn':'neu';
  const icon=tl==='up'?'↑ Bullish':tl==='dn'?'↓ Bearish':'→ Neutral';

  document.getElementById('aiBlock').innerHTML=`
    <div class="ai-summary ${tl}">
      <div class="ai-tag ${tl}">✦ Claude AI Analysis · ${icon} · Konfidenz ${sent.confidence||0}%</div>
      <div class="ai-text">${sent.reasoning||'–'}</div>
      ${(sent.key_factors||[]).length?`<div class="ai-factors">${sent.key_factors.map(f=>`<span class="ai-factor">${f}</span>`).join('')}</div>`:''}
    </div>`;

  document.getElementById('newsList').innerHTML=arts.length
    ? arts.map(a=>`
        <div class="news-card">
          <div class="news-headline"><a href="${a.link}" target="_blank">${a.title}</a></div>
          <div class="news-byline"><span class="news-src">${a.src}</span><span>${a.pub}</span></div>
        </div>`).join('')
    : '<div style="font-size:.72em;color:var(--text3);font-style:italic;">Keine passenden Nachrichten gefunden.</div>';
}

// ═══════════════════════════════════════════════════════════════════════
// PRICE UPDATE (all coins)
// ═══════════════════════════════════════════════════════════════════════
async function updatePrices(){
  for(const [id,c] of Object.entries(COINS)){
    try{
      const d=await getCGPrice(c.cg); if(!d) continue;
      const p=d.usd, ch=d.usd_24h_change||0, up=ch>=0;
      document.getElementById(`price-${id}`).textContent='$'+(p>1000?(p/1000).toFixed(2)+'K':p.toFixed(4));
      const el=document.getElementById(`chg-${id}`);
      el.textContent=(up?'+':'')+ch.toFixed(2)+'%';
      el.className='coin-chg '+(up?'up-c':'dn-c');
    }catch{}
  }
}

// ═══════════════════════════════════════════════════════════════════════
// MAIN LOAD
// ═══════════════════════════════════════════════════════════════════════
async function load(){
  const c=COINS[coin], apiKey=document.getElementById('apiKey').value.trim();
  document.getElementById('loader').classList.add('on');
  document.getElementById('content').style.display='none';
  document.getElementById('errNotice').classList.remove('on');
  document.getElementById('demoTag').classList.remove('on');

  let candles=[], isDemo=false;

  try{
    candles=slice(await getCGOHLC(c.cg,1), tf);
  }catch(e){
    isDemo=true;
    const bases={bitcoin:67000,ethereum:3500,solana:170,ripple:.62};
    candles=slice(demoData(bases[coin],52), tf);
    document.getElementById('errNotice').textContent=`Live-Daten konnten nicht geladen werden (${e.message}) — Demo-Modus aktiv`;
    document.getElementById('errNotice').classList.add('on');
    document.getElementById('demoTag').classList.add('on');
  }

  // Get live price
  let livePrice=candles[candles.length-1].close;
  if(!isDemo) try{const d=await getCGPrice(c.cg);if(d)livePrice=d.usd;}catch{}

  const last=candles[candles.length-1].close;
  const prev=candles[candles.length-2]?.close||last;
  const chgPct=((last-prev)/prev*100);
  const up=chgPct>=0;

  document.getElementById('coinLabel').textContent=`${c.name.toUpperCase()} · ${c.sym} / USD`;
  document.getElementById('priceBig').textContent='$'+livePrice.toLocaleString('de-DE',{minimumFractionDigits:2,maximumFractionDigits:4});
  document.getElementById('tfDisplay').textContent=TF_LABELS[tf]||tf;

  const badge=document.getElementById('priceBadge');
  badge.textContent=(up?'▲ +':'▼ ')+chgPct.toFixed(2)+'%';
  badge.className='price-change-badge '+(up?'up':'dn');

  const ind=indicators(candles);
  ts=ind.sc;

  buildCharts(candles, ind);
  updateInds(ind, candles);
  renderSigs(ind.sigs);

  // News + Claude
  let nScore=50;
  if(apiKey){
    const arts=await getNews(coin);
    const sent=await claudeAI(apiKey,`${c.name} (${c.sym})`,arts);
    nScore=sent.score||50;
    renderNews(arts,sent);
    document.getElementById('sNews').textContent=nScore+' / 100';
  }else{
    document.getElementById('aiBlock').innerHTML=`
      <div class="ai-summary neu">
        <div class="ai-tag neu">✦ Claude AI · Kein API Key</div>
        <div class="ai-text" style="font-style:italic;">Bitte Anthropic API Key eingeben um KI-basierte Nachrichtenanalyse zu aktivieren.</div>
      </div>`;
    document.getElementById('newsList').innerHTML='<div style="font-size:.72em;color:var(--text3);">API Key erforderlich für diese Funktion.</div>';
    document.getElementById('sNews').textContent='–';
  }

  ns=nScore;
  computeTrend(ts, ns);

  document.getElementById('loader').classList.remove('on');
  document.getElementById('content').style.display='block';
  document.querySelectorAll('.fade').forEach(el=>{
    el.style.animation='none'; void el.offsetHeight; el.style.animation='';
  });
}

// ═══════════════════════════════════════════════════════════════════════
// CONTROLS
// ═══════════════════════════════════════════════════════════════════════
function selectCoin(id){
  coin=id;
  document.querySelectorAll('.coin-pill').forEach(b=>b.classList.remove('active'));
  document.getElementById(`tab-${id}`).classList.add('active');
  load();
}

function setTF(t){
  tf=t;
  document.querySelectorAll('.tf-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById(`tf-${t}`).classList.add('active');
  load();
}

function refreshAll(){
  const btn=document.getElementById('btnRefresh');
  btn.disabled=true; btn.textContent='Lädt…';
  load().finally(()=>{btn.disabled=false; btn.textContent='↻ Aktualisieren';});
}

// ═══════════════════════════════════════════════════════════════════════
// NEWS HUB
// ═══════════════════════════════════════════════════════════════════════

// All news articles stored here
let allArticles = [];
let activeTab   = 'all';

// ── RSS Feed definitions ─────────────────────────────────────────────
const HUB_FEEDS = [
  // Crypto
  { url:'https://cointelegraph.com/rss',            name:'CoinTelegraph', cat:'crypto'  },
  { url:'https://decrypt.co/feed',                  name:'Decrypt',       cat:'crypto'  },
  { url:'https://cryptoslate.com/feed/',            name:'CryptoSlate',   cat:'crypto'  },
  // Macro / General Finance
  { url:'https://feeds.reuters.com/reuters/businessNews', name:'Reuters Business', cat:'macro' },
  { url:'https://www.investing.com/rss/news_301.rss',     name:'Investing.com',    cat:'macro' },
  { url:'https://rss.app/feeds/3RKNXmlbbgiQGrJK.xml',     name:'Financial Times',  cat:'macro' },
  // Fed / Rates
  { url:'https://feeds.feedburner.com/zerohedge/feed',    name:'ZeroHedge',        cat:'fed'     },
  { url:'https://www.federalreserve.gov/feeds/press_all.xml', name:'Fed Reserve',  cat:'fed'     },
  // Markets
  { url:'https://feeds.marketwatch.com/marketwatch/topstories/', name:'MarketWatch', cat:'markets' },
  { url:'https://rss.app/feeds/KnZgFWBsFbRPVJGR.xml',            name:'CNBC Markets','cat':'markets' },
];

// Keyword scoring for sentiment
const BULL_WORDS = ['surge','rally','bullish','breakout','record','gains','rise','above','boost','optimism','strong','growth','buy','upgrade','beat','exceeded','high'];
const BEAR_WORDS = ['crash','drop','fall','bearish','decline','selloff','dump','fear','concern','weak','risk','recession','cut','miss','below','warning','inflation','hawkish'];

function scoreSentiment(text){
  const t = text.toLowerCase();
  let score = 0;
  BULL_WORDS.forEach(w=>{ if(t.includes(w)) score++; });
  BEAR_WORDS.forEach(w=>{ if(t.includes(w)) score--; });
  if(score > 0)  return { label:'Bullish Signal', cls:'sent-bull', icon:'▲' };
  if(score < 0)  return { label:'Bearish Signal', cls:'sent-bear', icon:'▼' };
  return { label:'Neutral', cls:'sent-neut', icon:'◆' };
}

function timeAgo(dateStr){
  if(!dateStr) return '';
  const diff = Date.now() - new Date(dateStr).getTime();
  const m = Math.floor(diff/60000);
  if(m < 1)  return 'Gerade eben';
  if(m < 60) return `vor ${m} Min`;
  const h = Math.floor(m/60);
  if(h < 24) return `vor ${h} Std`;
  return `vor ${Math.floor(h/24)} Tagen`;
}

function srcClass(cat){ return 'src-'+cat; }
function srcLabel(cat){
  return {crypto:'Crypto', macro:'Makro', fed:'Fed / Zinsen', markets:'Märkte'}[cat] || cat;
}

// ── Fetch RSS via proxy ───────────────────────────────────────────────
async function fetchFeed(feed){
  const urls = [
    `https://api.allorigins.win/raw?url=${encodeURIComponent(feed.url)}`,
    `https://corsproxy.io/?${encodeURIComponent(feed.url)}`,
  ];
  for(const u of urls){
    try{
      const r = await fetch(u, {signal: AbortSignal.timeout(8000)});
      if(!r.ok) continue;
      const txt = await r.text();
      const doc = new DOMParser().parseFromString(txt, 'text/xml');
      const items = Array.from(doc.querySelectorAll('item')).slice(0, 8);
      return items.map(item => {
        const title   = item.querySelector('title')?.textContent?.trim() || '';
        const desc    = item.querySelector('description')?.textContent?.replace(/<[^>]+>/g,'').trim().slice(0,200) || '';
        const link    = item.querySelector('link')?.textContent?.trim() || '#';
        const pubDate = item.querySelector('pubDate')?.textContent?.trim() || '';
        const sent    = scoreSentiment(title + ' ' + desc);
        return { title, desc, link, pubDate, source: feed.name, cat: feed.cat, sent };
      }).filter(a => a.title.length > 5);
    }catch(e){ continue; }
  }
  return [];
}

// ── Render articles ───────────────────────────────────────────────────
function renderArticles(cat){
  const grid    = document.getElementById('newsGrid');
  const loading = document.getElementById('hubLoading');
  const empty   = document.getElementById('hubEmpty');

  const filtered = cat === 'all'
    ? allArticles
    : allArticles.filter(a => a.cat === cat);

  loading.style.display = 'none';

  if(!filtered.length){
    grid.style.display  = 'none';
    empty.style.display = 'block';
    return;
  }

  grid.style.display  = 'grid';
  empty.style.display = 'none';

  grid.innerHTML = filtered.map(a => `
    <div class="news-article">
      <div class="art-source-row">
        <span class="art-source ${srcClass(a.cat)}">${srcLabel(a.cat)}</span>
        <span class="art-age">${timeAgo(a.pubDate)}</span>
      </div>
      <div class="art-headline">
        <a href="${a.link}" target="_blank" rel="noopener">${a.title}</a>
      </div>
      ${a.desc ? `<div class="art-snippet">${a.desc}</div>` : ''}
      <div class="art-sentiment">
        <span class="${a.sent.cls}">${a.sent.icon} ${a.sent.label}</span>
        <span style="color:var(--text4);">·</span>
        <span style="color:var(--text3);font-weight:400;">${a.source}</span>
      </div>
    </div>`).join('');
}

function updateCounts(){
  const cats = ['crypto','macro','fed','markets'];
  document.getElementById('cnt-all').textContent = allArticles.length;
  cats.forEach(c=>{
    document.getElementById(`cnt-${c}`).textContent =
      allArticles.filter(a=>a.cat===c).length;
  });
}

function switchTab(cat){
  activeTab = cat;
  document.querySelectorAll('.news-tab').forEach(t=>t.classList.remove('active'));
  document.getElementById(`ntab-${cat}`).classList.add('active');
  renderArticles(cat);
}

// ── Load all feeds ────────────────────────────────────────────────────
async function loadHub(){
  const btn = document.getElementById('hubRefreshBtn');
  btn.disabled = true; btn.textContent = '↻ Lädt…';
  document.getElementById('hubLoading').style.display = 'flex';
  document.getElementById('newsGrid').style.display   = 'none';
  document.getElementById('hubEmpty').style.display   = 'none';
  document.getElementById('hubMeta').textContent      = 'Lade Nachrichten…';

  // Fetch all feeds in parallel (with per-feed timeout)
  const results = await Promise.allSettled(HUB_FEEDS.map(f => fetchFeed(f)));
  allArticles = [];
  results.forEach(r => { if(r.status==='fulfilled') allArticles.push(...r.value); });

  // Sort by date descending
  allArticles.sort((a,b) => new Date(b.pubDate||0) - new Date(a.pubDate||0));

  updateCounts();
  renderArticles(activeTab);

  const now = new Date().toLocaleTimeString('de-DE',{hour:'2-digit',minute:'2-digit'});
  document.getElementById('hubMeta').textContent =
    `${allArticles.length} Artikel · Aktualisiert ${now}`;

  btn.disabled = false; btn.textContent = '↻ Aktualisieren';
}

function refreshHub(){ loadHub(); loadTickers(); loadEconCalendar(); }

// ── Market Tickers via CoinGecko + free APIs ──────────────────────────
async function loadTickers(){
  // BTC dominance + Fear & Greed via CoinGecko global
  try{
    const r = await fetch('https://api.coingecko.com/api/v3/global');
    if(r.ok){
      const d = (await r.json()).data;
      const dom = d.market_cap_percentage?.bitcoin?.toFixed(1) || '–';
      document.getElementById('tk-btcdom').textContent = dom + '%';
      document.getElementById('tc-btcdom').textContent = 'BTC Dominanz';
      document.getElementById('tc-btcdom').style.color = 'var(--text3)';
    }
  }catch{}

  // Fear & Greed Index
  try{
    const r = await fetch('https://api.alternative.me/fng/?limit=1');
    if(r.ok){
      const d = await r.json();
      const val  = d.data[0].value;
      const label= d.data[0].value_classification;
      const color= val>60?'var(--up)':val<40?'var(--down)':'var(--neutral)';
      document.getElementById('tk-fng').textContent = val;
      document.getElementById('tk-fng').style.color = color;
      document.getElementById('tc-fng').textContent = label;
    }
  }catch{}

  // Gold, Oil, EUR/USD via open exchange (stooq CSV proxy approach)
  const stooqAssets = [
    { id:'gold',  sym:'GC.F',   tkId:'tk-gold',  tcId:'tc-gold',  label:'$ / oz' },
    { id:'oil',   sym:'CL.F',   tkId:'tk-oil',   tcId:'tc-oil',   label:'$ / bbl' },
    { id:'eurusd',sym:'EURUSD', tkId:'tk-eurusd',tcId:'tc-eurusd',label:'EUR/USD' },
  ];

  for(const a of stooqAssets){
    try{
      const url = `https://stooq.com/q/l/?s=${a.sym}&f=sd2t2ohlcv&h&e=csv`;
      const proxy = `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`;
      const r = await fetch(proxy, {signal: AbortSignal.timeout(6000)});
      if(!r.ok) continue;
      const txt = await r.text();
      const lines = txt.trim().split('\n');
      if(lines.length < 2) continue;
      const cols = lines[1].split(',');
      const close = parseFloat(cols[6]||cols[5]);
      const open  = parseFloat(cols[3]);
      if(!close || isNaN(close)) continue;
      const chg = ((close - open)/open*100).toFixed(2);
      const up  = parseFloat(chg) >= 0;
      document.getElementById(a.tkId).textContent =
        a.id==='eurusd' ? close.toFixed(4) : close.toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2});
      document.getElementById(a.tcId).textContent = (up?'+':'')+chg+'%';
      document.getElementById(a.tcId).style.color = up?'var(--up)':'var(--down)';
    }catch{}
  }

  // S&P 500 & Nasdaq via stooq
  const indices = [
    { sym:'^SPX', tkId:'tk-sp500', tcId:'tc-sp500' },
    { sym:'^NDX', tkId:'tk-nasdaq',tcId:'tc-nasdaq' },
  ];
  for(const idx of indices){
    try{
      const url = `https://stooq.com/q/l/?s=${idx.sym}&f=sd2t2ohlcv&h&e=csv`;
      const proxy = `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`;
      const r = await fetch(proxy, {signal: AbortSignal.timeout(6000)});
      if(!r.ok) continue;
      const txt  = await r.text();
      const cols = txt.trim().split('\n')[1]?.split(',') || [];
      const close = parseFloat(cols[6]||cols[5]);
      const open  = parseFloat(cols[3]);
      if(!close||isNaN(close)) continue;
      const chg = ((close-open)/open*100).toFixed(2);
      const up  = parseFloat(chg) >= 0;
      document.getElementById(idx.tkId).textContent =
        close.toLocaleString('en-US',{minimumFractionDigits:0,maximumFractionDigits:0});
      document.getElementById(idx.tcId).textContent = (up?'+':'')+chg+'%';
      document.getElementById(idx.tcId).style.color = up?'var(--up)':'var(--down)';
    }catch{}
  }
}

// ── Economic Calendar (curated important events) ──────────────────────
function loadEconCalendar(){
  // These are recurring major events — always relevant to watch
  const events = [
    { time:'Mi, 20:00',  name:'FOMC Protokoll / Fed Statement',              imp:'high'  },
    { time:'Fr, 14:30',  name:'US Non-Farm Payrolls (NFP)',                  imp:'high'  },
    { time:'Mi, 14:30',  name:'US CPI Inflationsdaten',                      imp:'high'  },
    { time:'Do, 14:30',  name:'US Erstanträge Arbeitslosenhilfe',             imp:'med'   },
    { time:'Di, 16:00',  name:'US ISM Verarbeitendes Gewerbe',               imp:'med'   },
    { time:'Do, 10:00',  name:'EZB Leitzins-Entscheid',                      imp:'high'  },
    { time:'Mi, 16:30',  name:'US EIA Rohöllagerbestände',                   imp:'med'   },
    { time:'Fr, 16:00',  name:'US Verbrauchervertrauen (Michigan)',           imp:'med'   },
    { time:'Di, 14:30',  name:'US PPI Erzeugerpreisindex',                   imp:'med'   },
    { time:'Mo, 16:00',  name:'US ISM Dienstleistungssektor PMI',            imp:'med'   },
  ];

  const strip = document.getElementById('econStrip');
  const header = strip.children[0];
  // Remove old events (keep header)
  while(strip.children.length > 1) strip.removeChild(strip.lastChild);

  events.forEach(ev => {
    const el = document.createElement('div');
    el.className = 'econ-event';
    el.innerHTML = `
      <div class="econ-event-time">${ev.time} UTC+1</div>
      <div class="econ-event-name">${ev.name}</div>
      <span class="econ-event-imp imp-${ev.imp}">
        ${ev.imp==='high'?'🔴 Hoch':ev.imp==='med'?'🟡 Mittel':'🟢 Niedrig'}
      </span>`;
    strip.appendChild(el);
  });
}

// ═══════════════════════════════════════════════════════════════════════
// INIT
// ═══════════════════════════════════════════════════════════════════════
updatePrices();
setInterval(updatePrices, 60000);
load();

// News Hub init
loadHub();
loadTickers();
loadEconCalendar();
// Auto-refresh news every 10 minutes
setInterval(()=>{ loadHub(); loadTickers(); }, 600000);
</script>
</body>
</html>
